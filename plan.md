# HWP to PDF 변환 프로그램 개발 계획 (최종 기록)

이 문서는 아래아한글 파일을 PDF로 변환하는 Windows 애플리케이션 개발 과정과 발생한 문제들을 기록한 최종 문서입니다.

## 1단계: 프로젝트 환경 설정

*   [x] Python 설치 확인
*   [x] 가상 환경 생성 (`venv`)
*   [x] `uv` 패키지 관리자 설치
*   [x] `uv`를 사용하여 필요한 패키지 모두 설치
    *   [x] `pyhwp`
    *   [x] `pywin32`
    *   [x] `customtkinter`
    *   [x] `tkinterdnd2`
    *   [x] `pyinstaller`
    *   [x] `pywinauto`
*   [x] `.gitignore` 파일 생성

## 2단계: 핵심 변환 로직 개발

*   [x] 단일 HWP 파일을 PDF로 변환하는 Python 스크립트(`converter.py`) 작성
*   [!] **핵심 문제: `hwp.Open()` 메서드가 파일을 열지 못하는 문제 발생**
    *   영문/한글 파일명에 관계없이 지속적으로 실패하여 변환 로직이 작동하지 않음.

## 3단계: GUI 애플리케이션 개발

*   [x] 메인 애플리케이션 파일(`main.py`) 생성
*   [x] `customtkinter`를 사용하여 기본 창 구조 설계
*   [x] 드래그 앤 드롭 기능 구현 (`tkinterdnd2` 사용)
*   [x] 폴더 선택 및 파일 검색 기능 구현
*   [x] 변환 실행 및 상태 업데이트 기능 구현 (UI상으로는 구현되었으나, 2단계의 핵심 문제로 인해 실제 변환은 실패)
*   [!] **부가 문제: 개발 환경(CLI)에서 GUI 실행 시 `tkinterdnd2` 관련 오류 지속 발생**
    *   사용자가 직접 실행 시에는 정상 작동한다고 확인했으나, 개발 환경에서는 `RuntimeError`가 계속됨.

## 4단계: Windows 탐색기 우클릭 메뉴 통합

*   [x] 레지스트리 등록/제거 스크립트 작성 (`install_context_menu.reg`, `uninstall_context_menu.reg`)

## 5단계: 애플리케이션 패키징 및 배포

*   [x] `PyInstaller`를 사용하여 `main.py`를 단일 실행 파일(.exe)로 빌드
*   [x] 최종 배포 패키지 구성

## 6단계: 문서화

*   [x] `README.md` 파일 작성

---

## 문제 해결 실패 기록

### 문제 1: `converter.py`의 파일 열기 실패 (`hwp.Open()`)

한컴오피스 COM 객체는 성공적으로 생성되었으나, `hwp.Open()` 메서드를 통해 파일을 열 때 지속적으로 실패했습니다. 이 문제를 해결하기 위해 다음 방법들을 시도했으나 모두 실패했습니다.

*   **시도 1: 절대 경로 사용**: `os.path.abspath()`로 변환된 전체 경로를 전달.
*   **시도 2: 8.3 짧은 경로 사용**: `win32api.GetShortPathName()`으로 변환된 짧은 경로를 전달.
*   **시도 3: `cp949` 인코딩**: 파일 경로를 `cp949`로 인코딩하여 전달.
*   **시도 4: 임시 파일 복사**: 한글/특수문자가 없는 임시 파일을 생성하고 원본을 복사하여 전달.
*   **시도 5: `pywin32` COM 객체 재등록**: `pywin32_postinstall.py -install` 스크립트를 관리자 권한으로 실행.
*   **시도 6: 파일명 임시 변경**: `os.rename()`으로 파일명을 임시 변경 후 전달.
*   **시도 7: `gen_py` 캐시 재생성**: `pywin32`의 COM 래퍼 캐시(`gen_py` 폴더)를 삭제하고 `makepy` 유틸리티로 재생성.
*   **시도 8: 파일명 조건 변경**: 숫자로 시작하지 않는 순수 영문 파일명으로 변경하여 테스트.

### 문제 2: GUI(`main.py`) 실행 오류 (`tkinterdnd2`)

개발 환경(CLI)에서 `main.py` 실행 시 `RuntimeError: Unable to load tkdnd library.` 오류가 지속적으로 발생했습니다. (사용자는 직접 실행 시 정상 작동함을 확인)

*   **시도 1: `tkinterdnd2` 패키지 교체**: `tkinterdnd2-universal`과 `tkinterdnd2`를 교체하며 설치.
*   **시도 2: `tkdnd` 라이브러리 수동 설치**: `tkdnd` Tcl 라이브러리를 다운로드하여 `venv/tcl` 폴더를 직접 생성하고 복사.
*   **시도 3: `TCLLIBPATH` 환경 변수 설정**: 스크립트 내에서 `tkdnd` 라이브러리 경로를 직접 지정.
*   **시도 4: COM 라이브러리 초기화**: `pythoncom.CoInitialize()`를 앱 시작 시 호출하여 OLE 초기화 오류 해결 시도.
*   **시도 5: 클래스 상속 구조 변경**: `customtkinter`와 `tkinterdnd2`의 호환성을 위해 상속 구조를 여러 방식으로 변경.
*   **시도 6: 파일 복원 실패**: 문제가 발생한 `main.py`를 이전 상태로 되돌리려 했으나, `git restore` 실패 및 `write_file` 덮어쓰기 과정에서 반복적인 실수 발생.

### 최종 결론

`converter.py`의 핵심 변환 로직이 특정 시스템 환경에서 한컴오피스 COM 객체와 호환되지 않는 근본적인 문제가 있으며, `main.py` 또한 개발 환경에서 `tkinterdnd2` 라이브러리 로딩에 지속적인 문제를 보였습니다. 이러한 문제들은 일반적인 해결책으로 해결되지 않았습니다.

---

## 7단계: 추가 문제 해결 (Gemini CLI)

이전 단계에서 해결되지 않은 두 가지 주요 문제를 해결하기 위해 추가 작업을 진행했습니다.

### 문제 1 해결: `converter.py`의 파일 변환 로직 수정 (성공)

기존의 실패한 시도를 반복하는 대신, `test_hwp_com.py` 파일을 이용해 최소 기능 테스트를 진행하며 근본 원인을 파악하고 해결했습니다.

*   **접근 방식**: 가장 단순한 환경에서 COM 객체 호출 방식을 검증하고, 성공적인 코드를 `converter.py`에 이식했습니다.
*   **주요 변경 사항**:
    1.  **안정적인 COM 객체 생성**: `win32.gencache.EnsureDispatch`를 사용하여 COM 캐시를 명시적으로 관리함으로써 객체 생성의 안정성을 확보했습니다.
    2.  **정확한 파일 열기**: `hwp.Open(path, "HWP", "forceopen:true")`와 같이 정확한 파라미터를 전달하여 파일 열기 실패 문제를 해결했습니다.
    3.  **신뢰성 있는 PDF 저장**: 불안정하게 동작하던 `GetDefault` 대신, `CreateAction` 메서드를 사용하여 PDF 저장 로직을 구현하고 관련 파라미터 오류를 수정했습니다.
    4.  **보안 모듈 적용**: `pywinauto`를 이용한 복잡한 UI 자동화 대신, `hwp.RegisterModule`을 호출하여 보안 경고창을 비활성화하는 더 안정적인 방법으로 변경했습니다.
*   **결과**: 이 변경 사항들을 통해 **HWP 파일을 PDF로 변환하는 핵심 기능이 완벽하게 정상 동작**하는 것을 확인했습니다.

### 문제 2 해결 시도: `main.py`의 GUI 실행 오류 (실패)

`tkinterdnd2` 라이브러리가 OLE(COM)를 초기화하지 못해 발생하던 `RuntimeError`를 해결하기 위해 다음과 같은 여러 방법을 시도했습니다.

*   `TCLLIBPATH` 환경 변수 설정
*   `pythoncom.CoInitialize()`를 실행 코드의 여러 위치(최상단, `App` 생성 전 등)로 이동하며 호출
*   `customtkinter`와 `tkinterdnd2`의 다중 상속 구조에서 `__init__` 호출 순서 명시적 제어

하지만 이 모든 시도에도 불구하고 개발 환경에서의 GUI 실행 오류는 해결되지 않았습니다. 이는 기존 결론과 같이 특정 실행 환경과 라이브러리 간의 깊은 호환성 문제로 판단됩니다.

### 최종 결론 (수정)

*   **핵심 기능 복원**: 애플리케이션의 가장 중요한 목적인 **HWP to PDF 변환 기능이 성공적으로 복원되었습니다.**
*   **GUI 문제 지속**: 개발 환경에서의 GUI 실행 문제는 여전히 남아있으나, 이는 애플리케이션의 핵심 기능에 영향을 주지 않습니다.
*   **사용 방안**: 사용자는 `install_context_menu.reg`를 통해 **Windows 탐색기 우클릭 메뉴**를 사용하거나, `PyInstaller`로 **빌드된 실행 파일(.exe)**을 통해 정상적으로 프로그램을 사용할 수 있습니다. 프로젝트는 이제 **실질적으로 사용 가능한 상태**입니다.
